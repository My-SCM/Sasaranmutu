import React, { useState, useEffect, useMemo } from 'react';
import { 
  LayoutDashboard, 
  Table as TableIcon, 
  Settings, 
  LogOut, 
  Plus, 
  Download, 
  Save, 
  Trash2, 
  Search,
  FileSpreadsheet,
  TrendingUp,
  AlertCircle,
  CheckCircle2,
  Menu,
  X,
  FileText,
  Boxes,
  Github
} from 'lucide-react';
import { 
  BarChart, 
  Bar, 
  XAxis, 
  YAxis, 
  CartesianGrid, 
  Tooltip, 
  Legend, 
  ResponsiveContainer
} from 'recharts';

// --- 1. DATA & KONFIGURASI ---
const INITIAL_DATA = [
  {
    id: 1,
    dept: "Supply Chain Management (Warehouse)",
    sasaran: "Pelaksanaan 5R",
    target: "100%",
    resources: "Form Check list",
    program: "Melaksanakan 5R di area kerja",
    pic: "EHS Manager, SCM Manager",
    formula: "(Jumlah Temuan/Hari Kerja) X 100%",
    freq: "per bulan",
    m1: "100%", m2: "", m3: "", m4: "", m5: "", m6: "", 
    m7: "", m8: "", m9: "", m10: "", m11: "", m12: "",
    evidence: ""
  },
  {
    id: 2,
    dept: "Supply Chain Management",
    sasaran: "Penggunaan APD",
    target: "100%",
    resources: "Peraturan perusahaan, kebijakan K3",
    program: "Memonitoring Penggunaan APD di area yang ditetapkan",
    pic: "EHS Manager, All Team SCM",
    formula: "(Jumlah Temuan/Hari Kerja) X 100%",
    freq: "per bulan",
    m1: "100%", m2: "", m3: "", m4: "", m5: "", m6: "", 
    m7: "", m8: "", m9: "", m10: "", m11: "", m12: "",
    evidence: ""
  },
  {
    id: 3,
    dept: "Supply Chain Management ( Inventory )",
    sasaran: "Akurasi Stock Inventory",
    target: "100%",
    resources: "Sistem Manajemen Persediaan (Inventory Management System), Pengawasan dan Audit Internal ( STO )",
    program: "Monitoring pengelolaan inventory",
    pic: "SCM Manager",
    formula: "(Stock aktual/stock sistem) X 100%",
    freq: "per bulan",
    m1: "100%", m2: "", m3: "", m4: "", m5: "", m6: "", 
    m7: "", m8: "", m9: "", m10: "", m11: "", m12: "",
    evidence: ""
  },
  {
    id: 4,
    dept: "Supply Chain Management",
    sasaran: "Kerusakan Produk FG Akibat Handling",
    target: "0,50% MAX",
    resources: "Standard R&D/QC",
    program: "Monitoring produk reject",
    pic: "SCM Manager",
    formula: "Jumlah Temuan Reject/Jumlah Rilis x 100%",
    freq: "per bulan",
    m1: "0%", m2: "", m3: "", m4: "", m5: "", m6: "", 
    m7: "", m8: "", m9: "", m10: "", m11: "", m12: "",
    evidence: ""
  }
];

// --- 2. SUB-KOMPONEN ---

// Login Component
const Login = ({ onLogin }) => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    if (username === 'admin' && password === 'admin123') {
      onLogin();
    } else {
      setError('Username atau password salah');
    }
  };

  return (
    <div className="min-h-screen bg-slate-100 flex items-center justify-center p-4">
      <div className="bg-white p-8 rounded-lg shadow-lg max-w-sm w-full border border-slate-200">
        <div className="text-center mb-6">
          <div className="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <Boxes className="text-white w-8 h-8" />
          </div>
          <h1 className="text-2xl font-bold text-slate-800">SCM DASHBOARD</h1>
          <p className="text-slate-500 text-sm">Sistem Sasaran Mutu Supply Chain</p>
        </div>
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-1">Username</label>
            <input 
              type="text" 
              className="w-full px-4 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              placeholder="admin"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-1">Password</label>
            <input 
              type="password" 
              className="w-full px-4 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              placeholder="••••••••"
            />
          </div>
          {error && <p className="text-red-500 text-sm text-center">{error}</p>}
          <button 
            type="submit"
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200"
          >
            Masuk
          </button>
        </form>
      </div>
    </div>
  );
};

// Dashboard View Component
const DashboardView = ({ data }) => {
  const parseVal = (val) => {
    if (!val) return 0;
    let strVal = String(val).replace(/[a-zA-Z]/g, "").trim().replace(',', '.');
    if (strVal.includes('%')) return parseFloat(strVal.replace('%', ''));
    const floatVal = parseFloat(strVal);
    if (!isNaN(floatVal) && floatVal <= 1 && floatVal > 0) return floatVal * 100;
    return floatVal;
  };

  const chartData = useMemo(() => {
    return data.map(item => ({
      name: item.sasaran.length > 20 ? item.sasaran.substring(0, 20) + '...' : item.sasaran,
      target: parseVal(item.target),
      actual: item.m1 ? parseVal(item.m1) : 0 
    }));
  }, [data]);

  return (
    <div className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 border-l-4 border-l-blue-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-slate-500 mb-1">Total Item KPI</p>
              <h3 className="text-3xl font-bold text-slate-800">{data.length}</h3>
            </div>
            <div className="bg-blue-100 p-3 rounded-full text-blue-600">
              <FileSpreadsheet size={24} />
            </div>
          </div>
        </div>
        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 border-l-4 border-l-green-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-slate-500 mb-1">Rata-rata Target</p>
              <h3 className="text-3xl font-bold text-slate-800">
                {(chartData.reduce((acc, curr) => acc + curr.target, 0) / (data.length || 1)).toFixed(1)}%
              </h3>
            </div>
            <div className="bg-green-100 p-3 rounded-full text-green-600">
              <TrendingUp size={24} />
            </div>
          </div>
        </div>
        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 border-l-4 border-l-purple-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-slate-500 mb-1">Realisasi (Januari)</p>
              <h3 className="text-3xl font-bold text-slate-800">
                 {(chartData.reduce((acc, curr) => acc + curr.actual, 0) / (data.length || 1)).toFixed(1)}%
              </h3>
            </div>
            <div className="bg-purple-100 p-3 rounded-full text-purple-600">
              <AlertCircle size={24} />
            </div>
          </div>
        </div>
      </div>

      <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h3 className="text-lg font-bold text-slate-700 mb-6">Perbandingan Target vs Realisasi</h3>
        <div className="h-80">
          <ResponsiveContainer width="100%" height="100%">
            <BarChart data={chartData} layout="vertical" margin={{ left: 20 }}>
              <CartesianGrid strokeDasharray="3 3" horizontal={true} vertical={true} />
              <XAxis type="number" domain={[0, 110]} />
              <YAxis dataKey="name" type="category" width={150} tick={{fontSize: 12}} />
              <Tooltip cursor={{fill: 'transparent'}} />
              <Legend />
              <Bar dataKey="target" name="Target (%)" fill="#e2e8f0" barSize={20} radius={[0, 4, 4, 0]} />
              <Bar dataKey="actual" name="Realisasi (%)" fill="#3b82f6" barSize={20} radius={[0, 4, 4, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );
};

// Data Table View Component (Improved Layout & Sticky Headers)
const DataTableView = ({ data }) => {
  const [filter, setFilter] = useState('');
  
  const filteredData = data.filter(item => {
    return item.sasaran.toLowerCase().includes(filter.toLowerCase()) || 
           item.pic.toLowerCase().includes(filter.toLowerCase());
  });

  const exportToExcel = () => {
    if (!window.XLSX) { alert("Library Excel belum siap."); return; }
    
    const exportData = [
      ["PENCAPAIAN SASARAN MUTU, K3 DAN LINGKUNGAN (TAHUN 2025)"],
      ["Unit/Fungsi:", "Supply Chain Management"],
      ["Periode:", "2025"],
      [],
      ["No", "Sub-Unit", "Sasaran Mutu", "Target", "Sumber Daya", "Program Kerja", "Penanggung Jawab", "Formula", "Freq", "Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Ags", "Sep", "Okt", "Nov", "Des", "Rekaman"]
    ];
    
    filteredData.forEach((item, index) => {
      exportData.push([
        index + 1, item.dept, item.sasaran, item.target, item.resources, item.program, item.pic, item.formula, item.freq,
        item.m1, item.m2, item.m3, item.m4, item.m5, item.m6, item.m7, item.m8, item.m9, item.m10, item.m11, item.m12, item.evidence
      ]);
    });

    const wb = window.XLSX.utils.book_new();
    const ws = window.XLSX.utils.aoa_to_sheet(exportData);
    ws['!cols'] = [{wch: 5}, {wch: 35}, {wch: 40}, {wch: 15}, {wch: 25}, {wch: 30}, {wch: 25}, {wch: 25}, {wch: 10}];
    window.XLSX.utils.book_append_sheet(wb, ws, "SCM 2025");
    window.XLSX.writeFile(wb, "Sasaran_Mutu_SCM_2025.xlsx");
  };

  const exportToPDF = () => {
    if (!window.jspdf) { alert("Library PDF belum siap."); return; }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('l', 'mm', 'a4');

    doc.setFontSize(14);
    doc.text("PENCAPAIAN SASARAN MUTU - SUPPLY CHAIN MANAGEMENT", 14, 15);
    doc.setFontSize(10);
    doc.text("Periode: 2025", 14, 22);

    const tableColumn = ["No", "Sub-Unit", "Sasaran Mutu", "Target", "PIC", "Realisasi (Jan-Des)", "Rekaman"];
    const tableRows = filteredData.map((item, index) => {
      const months = [item.m1, item.m2, item.m3, item.m4, item.m5, item.m6, item.m7, item.m8, item.m9, item.m10, item.m11, item.m12]
        .filter(m => m && m !== "").join(", ");
      return [index + 1, item.dept, item.sasaran, item.target, item.pic, months || "-", item.evidence];
    });

    doc.autoTable({
      head: [tableColumn], body: tableRows, startY: 30, theme: 'grid',
      headStyles: { fillColor: [41, 128, 185] }, styles: { fontSize: 8, cellPadding: 2 },
      columnStyles: { 0: { cellWidth: 10 }, 1: { cellWidth: 35 }, 2: { cellWidth: 65 }, 3: { cellWidth: 20 }, 4: { cellWidth: 30 }, 5: { cellWidth: 60 }, 6: { cellWidth: 30 } }
    });
    doc.save("Laporan_SCM_2025.pdf");
  };

  return (
    <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-[calc(100vh-150px)]">
      {/* Controls */}
      <div className="p-4 border-b border-slate-200 flex flex-col md:flex-row gap-4 justify-between bg-slate-50 shrink-0">
        <div className="relative flex-1 max-w-md">
          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" size={18} />
          <input type="text" placeholder="Cari indikator..." className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" value={filter} onChange={(e) => setFilter(e.target.value)} />
        </div>
        <div className="flex gap-2">
          <button onClick={exportToPDF} className="flex items-center space-x-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors shadow-sm text-sm"><FileText size={16} /><span>PDF</span></button>
          <button onClick={exportToExcel} className="flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors shadow-sm text-sm"><Download size={16} /><span>Excel</span></button>
        </div>
      </div>

      {/* Scrollable Table Area */}
      <div className="flex-1 overflow-auto">
        <table className="w-full text-sm text-left text-slate-600 border-collapse">
          <thead className="text-xs text-slate-700 uppercase bg-slate-100">
            <tr>
              {/* Sticky Top-Left Corner */}
              <th className="px-4 py-3 sticky left-0 top-0 z-30 bg-slate-100 border-r border-b border-slate-300 shadow-sm w-12 text-center">No</th>
              
              {/* Sticky Top Headers */}
              <th className="px-4 py-3 sticky top-0 z-20 bg-slate-100 border-b border-slate-300 min-w-[200px] whitespace-nowrap">Unit/Fungsi</th>
              <th className="px-4 py-3 sticky top-0 z-20 bg-slate-100 border-b border-slate-300 min-w-[300px] whitespace-nowrap">Sasaran Mutu</th>
              <th className="px-4 py-3 sticky top-0 z-20 bg-slate-100 border-b border-slate-300 min-w-[100px] whitespace-nowrap">Target</th>
              <th className="px-4 py-3 sticky top-0 z-20 bg-slate-100 border-b border-slate-300 min-w-[150px] whitespace-nowrap">PIC</th>
              <th className="px-4 py-3 sticky top-0 z-20 bg-slate-100 border-b border-slate-300 text-center whitespace-nowrap">Freq</th>
              
              {/* Months Headers */}
              {[...Array(12)].map((_, i) => (
                <th key={i} className="px-2 py-3 sticky top-0 z-20 bg-slate-100 border-b border-l border-slate-300 text-center min-w-[60px] whitespace-nowrap">{i+1}</th>
              ))}
            </tr>
          </thead>
          <tbody>
            {filteredData.length > 0 ? (
              filteredData.map((item, index) => (
                <tr key={item.id} className="group hover:bg-blue-50 transition-colors even:bg-slate-50">
                  {/* Sticky Left Column */}
                  <td className="px-4 py-3 sticky left-0 border-r border-b border-slate-200 font-medium z-10 text-center bg-inherit shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)]">
                    {index + 1}
                  </td>
                  
                  {/* Data Columns */}
                  <td className="px-4 py-3 border-b border-slate-200 font-semibold text-slate-700 whitespace-nowrap">{item.dept}</td>
                  <td className="px-4 py-3 border-b border-slate-200 whitespace-nowrap max-w-[300px] truncate" title={item.sasaran}>{item.sasaran}</td>
                  <td className="px-4 py-3 border-b border-slate-200 text-blue-600 font-medium whitespace-nowrap">{item.target}</td>
                  <td className="px-4 py-3 border-b border-slate-200 whitespace-nowrap">{item.pic}</td>
                  <td className="px-4 py-3 border-b border-slate-200 text-center whitespace-nowrap">{item.freq}</td>
                  
                  {/* Months Data */}
                  {[...Array(12)].map((_, i) => (
                    <td key={i} className="px-2 py-3 border-b border-l border-slate-200 text-center text-xs whitespace-nowrap">{item[`m${i+1}`]}</td>
                  ))}
                </tr>
              ))
            ) : (
              <tr><td colSpan="18" className="px-6 py-12 text-center text-slate-400"><div className="flex flex-col items-center justify-center"><AlertCircle size={48} className="mb-2 opacity-50" /><p>Tidak ada data ditemukan</p></div></td></tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

// Admin Panel Component
const AdminPanel = ({ data, setData }) => {
  const [formData, setFormData] = useState({
    id: null, dept: '', sasaran: '', target: '', resources: '', program: '', pic: '', formula: '', freq: 'per bulan',
    m1: '', m2: '', m3: '', m4: '', m5: '', m6: '', m7: '', m8: '', m9: '', m10: '', m11: '', m12: '', evidence: ''
  });
  const [isEditing, setIsEditing] = useState(false);

  const handleChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });

  const handleSubmit = (e) => {
    e.preventDefault();
    if (isEditing) {
      setData(data.map(item => (item.id === formData.id ? formData : item)));
      setIsEditing(false);
    } else {
      setData([...data, { ...formData, id: Date.now() }]);
    }
    resetForm();
  };

  const handleEdit = (item) => {
    setFormData(item);
    setIsEditing(true);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const handleDelete = (id) => {
    if (window.confirm("Hapus data ini?")) setData(data.filter(item => item.id !== id));
  };

  const resetForm = () => {
    setFormData({
      id: null, dept: '', sasaran: '', target: '', resources: '', program: '', pic: '', formula: '', freq: 'per bulan',
      m1: '', m2: '', m3: '', m4: '', m5: '', m6: '', m7: '', m8: '', m9: '', m10: '', m11: '', m12: '', evidence: ''
    });
    setIsEditing(false);
  };

  return (
    <div className="space-y-8">
      <div className="bg-white rounded-xl shadow-md border border-slate-200 p-6">
        <div className="flex justify-between items-center mb-6">
          <h3 className="text-lg font-bold text-slate-800 flex items-center">
            {isEditing ? <Settings className="mr-2 text-blue-600" /> : <Plus className="mr-2 text-green-600" />}
            {isEditing ? "Edit Data KPI" : "Tambah KPI Baru"}
          </h3>
          {isEditing && <button onClick={resetForm} className="text-sm text-red-500 hover:text-red-700 underline">Batal Edit</button>}
        </div>

        <form onSubmit={handleSubmit} className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div><label className="block text-sm font-medium text-slate-700 mb-1">Unit / Fungsi</label><input name="dept" value={formData.dept} onChange={handleChange} required className="w-full p-2 border rounded" placeholder="SCM Warehouse" /></div>
            <div><label className="block text-sm font-medium text-slate-700 mb-1">PIC</label><input name="pic" value={formData.pic} onChange={handleChange} required className="w-full p-2 border rounded" /></div>
            <div className="md:col-span-2"><label className="block text-sm font-medium text-slate-700 mb-1">Sasaran Mutu</label><textarea name="sasaran" value={formData.sasaran} onChange={handleChange} required className="w-full p-2 border rounded" rows="2"></textarea></div>
            <div><label className="block text-sm font-medium text-slate-700 mb-1">Target</label><input name="target" value={formData.target} onChange={handleChange} required className="w-full p-2 border rounded" /></div>
            <div><label className="block text-sm font-medium text-slate-700 mb-1">Sumber Daya</label><input name="resources" value={formData.resources} onChange={handleChange} className="w-full p-2 border rounded" /></div>
            <div><label className="block text-sm font-medium text-slate-700 mb-1">Program Kerja</label><input name="program" value={formData.program} onChange={handleChange} className="w-full p-2 border rounded" /></div>
            <div><label className="block text-sm font-medium text-slate-700 mb-1">Formula</label><input name="formula" value={formData.formula} onChange={handleChange} className="w-full p-2 border rounded" /></div>
            <div>
              <label className="block text-sm font-medium text-slate-700 mb-1">Frekuensi</label>
              <select name="freq" value={formData.freq} onChange={handleChange} className="w-full p-2 border rounded bg-white">
                <option value="per bulan">per bulan</option>
                <option value="per 3 bulan">per 3 bulan</option>
                <option value="per tahun">per tahun</option>
              </select>
            </div>
          </div>
          <div className="border-t border-slate-200 pt-4">
            <h4 className="text-sm font-bold text-slate-600 mb-3">Realisasi Bulanan</h4>
            <div className="grid grid-cols-6 gap-2">
               {[...Array(12)].map((_, i) => (
                 <div key={i}>
                   <label className="text-xs text-slate-500 block mb-1">Bln {i+1}</label>
                   <input name={`m${i+1}`} value={formData[`m${i+1}`]} onChange={handleChange} className="w-full text-center text-sm p-1 border rounded" />
                 </div>
               ))}
            </div>
          </div>
          <div className="flex justify-end pt-4">
             <button type="submit" className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg flex items-center shadow-lg"><Save size={18} className="mr-2" />{isEditing ? "Simpan Perubahan" : "Simpan Data"}</button>
          </div>
        </form>
      </div>
      <div className="bg-white rounded-xl shadow border border-slate-200 overflow-hidden">
        <div className="p-4 bg-slate-50 border-b border-slate-200"><h3 className="font-bold text-slate-700">Database KPI</h3></div>
        <div className="overflow-x-auto max-h-[500px]">
          <table className="w-full text-sm text-left">
            <thead className="text-xs text-slate-700 uppercase bg-slate-100">
              <tr>
                <th className="px-4 py-3">Sasaran</th><th className="px-4 py-3">Target</th><th className="px-4 py-3">PIC</th><th className="px-4 py-3 text-right">Aksi</th>
              </tr>
            </thead>
            <tbody>
              {data.map((item) => (
                <tr key={item.id} className="border-b hover:bg-slate-50">
                  <td className="px-4 py-3 font-medium">{item.sasaran}</td><td className="px-4 py-3">{item.target}</td><td className="px-4 py-3">{item.pic}</td>
                  <td className="px-4 py-3 text-right space-x-2">
                    <button onClick={() => handleEdit(item)} className="text-blue-600 border border-blue-200 px-2 py-1 rounded bg-blue-50 text-xs">Edit</button>
                    <button onClick={() => handleDelete(item.id)} className="text-red-600 border border-red-200 px-2 py-1 rounded bg-red-50 text-xs">Hapus</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

// --- 3. MAIN APP COMPONENT ---
// Dipindahkan ke bawah agar semua sub-komponen sudah terdefinisi saat dipanggil
export default function App() {
  const [user, setUser] = useState(null); 
  const [view, setView] = useState('dashboard');
  const [data, setData] = useState(INITIAL_DATA);
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);

  // Load External Libs
  useEffect(() => {
    const scripts = [
      "https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js",
      "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",
      "https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"
    ];
    scripts.forEach(src => {
      const script = document.createElement('script');
      script.src = src;
      script.async = true;
      document.body.appendChild(script);
    });
  }, []);

  const handleLogout = () => { setUser(null); setView('dashboard'); };

  const navItems = [
    { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
    { id: 'data', label: 'Data Mentah', icon: TableIcon },
    { id: 'admin', label: 'Input Admin', icon: Settings },
  ];

  if (!user && view === 'admin') return <Login onLogin={() => setUser('admin')} />;

  return (
    <div className="flex h-screen bg-slate-50 overflow-hidden font-sans">
      <aside className={`${isSidebarOpen ? 'w-64' : 'w-20'} bg-slate-900 text-white transition-all duration-300 flex flex-col shadow-xl z-20`}>
        <div className="p-4 flex items-center justify-between border-b border-slate-700">
          {isSidebarOpen ? <div className="flex items-center space-x-2"><div className="bg-blue-500 p-1 rounded"><Boxes size={20} /></div><span className="font-bold text-lg tracking-tight truncate">SCM SYSTEM</span></div> : <div className="mx-auto bg-blue-500 p-2 rounded"><Boxes size={20} /></div>}
          <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-white">{isSidebarOpen ? <X size={18} /> : <Menu size={18} />}</button>
        </div>
        <nav className="flex-1 py-6 px-3 space-y-2">
          {navItems.map((item) => (
            <button key={item.id} onClick={() => { if(item.id === 'admin' && !user) { setView('admin'); } else { setView(item.id); } }} className={`w-full flex items-center space-x-3 px-3 py-3 rounded-lg transition-colors ${view === item.id ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}><item.icon size={20} />{isSidebarOpen && <span>{item.label}</span>}</button>
          ))}
          <a href="https://github.com/username/scm-dashboard" target="_blank" rel="noopener noreferrer" className="w-full flex items-center space-x-3 px-3 py-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-colors"><Github size={20} />{isSidebarOpen && <span>GitHub Repo</span>}</a>
        </nav>
        <div className="p-4 border-t border-slate-700">
          {user ? <button onClick={handleLogout} className="w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-red-400 hover:bg-red-900/20 transition-colors"><LogOut size={20} />{isSidebarOpen && <span>Keluar</span>}</button> : <div className="text-xs text-center text-slate-500">{isSidebarOpen && "Guest Mode"}</div>}
        </div>
      </aside>
      <main className="flex-1 overflow-auto relative">
        <header className="bg-white shadow-sm p-4 sticky top-0 z-10 flex justify-between items-center">
          <div><h2 className="text-xl font-semibold text-slate-800">{view === 'dashboard' && 'Dashboard SCM'}{view === 'data' && 'Data Mentah SCM'}{view === 'admin' && 'Panel Admin SCM'}</h2><p className="text-xs text-slate-500">Supply Chain Management - Sasaran Mutu</p></div>
          <div className="flex items-center space-x-4"><span className="text-sm text-slate-500">Periode: 2025</span>{user && <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded-full flex items-center"><CheckCircle2 size={12} className="mr-1" /> Admin Logged In</span>}</div>
        </header>
        <div className="p-6">
          {view === 'dashboard' && <DashboardView data={data} />}
          {view === 'data' && <DataTableView data={data} />}
          {view === 'admin' && <AdminPanel data={data} setData={setData} />}
        </div>
      </main>
    </div>
  );
}
